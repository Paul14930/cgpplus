<h1>Informations du Client</h1>

<p>
  <strong>Nom :</strong>
  <%= @client.nom %>
</p>

<p>
  <strong>Prénom :</strong>
  <%= @client.prenom %>
</p>

<p>
  <strong>Date de Naissance :</strong>
  <%= @client.date_naissance %>
</p>

<p>
  <strong>Situation Matrimoniale :</strong>
  <%= @client.situation_matrimoniale %>
</p>

<p>
  <strong>Régime Matrimonial :</strong>
  <%= @client.regime_matrimonial %>
</p>

<p>
  <strong>Présence Enfants :</strong>
  <%= @client.presence_enfants ? 'Oui' : 'Non' %>
</p>

<p>
  <strong>Civilité :</strong>
  <%= @client.civilite %>
</p>

<p>
  <strong>Email :</strong>
  <%= @client.email %>
</p>

<p>
  <strong>Téléphone Principal :</strong>
  <%= @client.telephone_principal %>
</p>

<p>
  <strong>Téléphone Secondaire :</strong>
  <%= @client.telephone_secondaire %>
</p>

<p>
  <strong>Adresse :</strong>
  <%= @client.adresse %>
</p>

<p>
  <strong>Code Postal :</strong>
  <%= @client.code_postal %>
</p>

<p>
  <strong>Ville :</strong>
  <%= @client.ville %>
</p>
<%= link_to 'Ajouter une entreprise', new_cgp_client_entreprise_path(@cgp, @client), class: 'inline-block px-6 py-2 text-white font-bold bg-green-500 hover:bg-green-700 rounded' %>

<%= link_to 'Ajouter un bien immobilier pour le client', new_client_immobilier_path(@client), class: 'inline-block px-6 py-2 text-white font-bold bg-orange-500 hover:bg-orange-700 rounded' %>




<h2>Biens immobiliers de <%= @client.nom %> <%= @client.prenom %></h2>

<table class="min-w-full table-auto">
  <thead class="justify-between">
    <tr class="bg-gray-800">
      <th class="px-16 py-2">
        <span class="text-gray-300">Désignation</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Date d'Acquisition</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Valeur Acquisition</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Taux de Détention (%)</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Valeur Actuelle</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Type de Détention</span>
      </th>
      <th class="px-16 py-2">
        <span class="text-gray-300">Action</span>
      </th>
    </tr>
  </thead>
  <tbody class="bg-gray-200">
    <% @client.immobiliers.each do |immobilier| %>
      <tr class="bg-white border-4 border-gray-200">
        <td class="px-16 py-2 flex flex-row items-center">
          <%= immobilier.designation %>
        </td>
        <td class="px-16 py-2">
          <%= immobilier.date_acquisition %>
        </td>
        <td class="px-16 py-2">
          <%= immobilier.valeur_acquisition %> €
        </td>
        <td class="px-16 py-2">
          <%= immobilier.taux_detention %>
        </td>
        <td class="px-16 py-2">
          <%= immobilier.valeur_actuelle %> €
        </td>
        <td class="px-16 py-2">
          <%= immobilier.type_detention %>
        </td>
          <td>
<%= form_with url: client_immobilier_path(@client, immobilier), method: :delete do %>
  <%= submit_tag 'Supprimer', data: { turbo_confirm: 'Êtes-vous sûr ?', turbo_method: :delete }, class: 'bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded' %>
<% end %>

<%= link_to 'Éditer', edit_client_immobilier_path(@client, immobilier), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>



    </td>
      </tr>
    <% end %>
  </tbody>
</table>

<h2>Entreprises de <%= @client.nom %> <%= @client.prenom %></h2>

<table class="min-w-full leading-normal">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Forme Juridique</th>
      <th>Activité</th>
      <th>Capital Social</th>
      <th>Valeur Estimée</th>
      <th>Date de Création</th>
      <th>Date d'Acquisition</th>
      <th>Taux de Détention</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @entreprises.where(entreprise_mere_id: nil).each do |entreprise| %>
      <tr>
        <td><%= entreprise.nom %></td>
        <td><%= entreprise.forme_juridique %></td>
        <td><%= entreprise.activite %></td>
        <td><%= entreprise.capital_social %></td>
        <td><%= entreprise.valeur_estimee %> € </td>
        <td><%= entreprise.date_creation %></td>
        <td><%= entreprise.date_acquisition %></td>
        <td><%= entreprise.taux_detention %>%</td>
        <td>
          <%= link_to 'Éditer', edit_cgp_client_entreprise_path(@cgp, @client, entreprise) %>
          <%= link_to 'Ajouter une filiale', new_cgp_client_entreprise_path(@cgp, @client, entreprise_mere_id: entreprise.id) %>
      <%= link_to 'Ajouter un bien immobilier pour l\'entreprise', new_client_immobilier_path(client_id: @client.id, proprietable_type: 'Entreprise', proprietable_id: entreprise.id) %>

        </td>
      </tr>
      <% if entreprise.immobiliers.any? %>
  <% entreprise.immobiliers.each do |immobilier| %>
    <tr class="bg-blue-100">
       <td colspan="8">
      Bien Immobilier: <%= immobilier.designation %>, Valeur: <%= immobilier.valeur_actuelle %> €
      <%= form_with url: entreprise_immobilier_path(entreprise, immobilier), method: :delete do %>
        <%= submit_tag 'Supprimer', data: { confirm: 'Êtes-vous sûr ?', turbo: false }, class: 'bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded' %>
      <% end %>
    </td>
  </tr>
  <% end %>
<% end %>
      <% entreprise.filiales.each do |filiale| %>
        <tr class="bg-gray-100">
           <td>
    <%= filiale.nom %> (Filiale de <%= filiale.entreprise_mere.nom %>)
  </td>
          <td><%= filiale.forme_juridique %></td>
          <td><%= filiale.activite %></td>
          <td><%= filiale.capital_social %></td>
          <td><%= filiale.valeur_estimee %> €</td>
          <td><%= filiale.date_creation %></td>
          <td><%= filiale.date_acquisition %></td>
          <td><%= filiale.taux_detention %>%</td>
          <td>
            <%= link_to 'Éditer', edit_cgp_client_entreprise_path(@cgp, @client, filiale) %>

            <%= link_to 'Ajouter un bien immobilier pour la filiale', new_client_immobilier_path(client_id: @client.id, proprietable_type: 'Entreprise', proprietable_id: filiale.id) %>

          </td>
        </tr>
         <% if filiale.immobiliers.any? %>
   <% filiale.immobiliers.each do |immobilier| %>
  <tr class="bg-green-100">
    <td colspan="8">
      Bien Immobilier de la filiale: <%= immobilier.designation %>, Valeur: <%= immobilier.valeur_actuelle %> €
      <%= form_with url: filiale_immobilier_path(filiale, immobilier), method: :delete do %>
        <%= submit_tag 'Supprimer', data: { confirm: 'Êtes-vous sûr ?', turbo: false }, class: 'bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded' %>
      <% end %>
    </td>
  </tr>
    <% end %>
  <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>
